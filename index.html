<!DOCTYPE html>
<html>
<head>
  <meta charset="UTF-8">
  <title>Two-Deck DJ YouTube Player</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <style>
    /* (Include your CSS from the code sample above) */
    body { 
      font-family: Arial, sans-serif; 
      margin: 20px; 
      text-align: center;
    }
    .deck-container {
      border: 2px solid #ccc;
      border-radius: 8px;
      padding: 15px;
      margin-bottom: 30px;
      max-width: 700px;
      margin: 0 auto 30px auto;
    }
    .deck-title {
      font-size: 1.2em;
      font-weight: bold;
      margin-bottom: 10px;
    }
    .video-input {
      margin-bottom: 10px;
    }
    .player-section {
      margin-top: 10px;
    }
    .mobileControls {
      margin-top: 10px;
    }
    button {
      padding: 8px 12px;
      margin: 5px;
      font-size: 14px;
      border: none;
      border-radius: 5px;
      background-color: #4285F4;
      color: white;
      cursor: pointer;
    }
    button:active {
      background-color: #3367D6;
    }
    .slider-container {
      margin: 10px auto;
      max-width: 300px;
      text-align: left;
    }
    .slider-label {
      display: inline-block;
      width: 120px;
      text-align: right;
      margin-right: 5px;
    }
    input[type="range"] {
      vertical-align: middle;
      width: 120px;
    }
    .cue-list {
      text-align: left; 
      display: inline-block; 
      margin-top: 10px;
    }
    ul {
      padding-left: 20px;
    }
  </style>
</head>
<body>
  <h1>Two-Deck DJ YouTube Player</h1>
  <p>
    Enter a YouTube link for each deck, then control each independently.<br>
    <strong>Keyboard Shortcuts:</strong><br>
    Deck 1 = normal key; Deck 2 = hold Shift + key  
    • Space: Play/Pause  
    • C: Set Cue  
    • ←/→: Prev/Next Cue  
    • ↑/↓: Speed ±  
  </p>

  <!-- Deck 1 -->
  <div class="deck-container">
    <div class="deck-title">Deck 1</div>
    
    <!-- Input & Load button -->
    <div class="video-input">
      <input type="text" id="videoLink1" placeholder="https://www.youtube.com/watch?v=VIDEO_ID" size="40">
      <button id="loadVideo1">Load Video (Deck 1)</button>
    </div>
    
    <!-- YouTube player area -->
    <div id="player1" class="player-section"></div>
    
    <!-- Mobile / Onscreen Controls for Deck 1 -->
    <div class="mobileControls" id="mobileControls1">
      <button id="btn-play1">Play/Pause</button>
      <button id="btn-set-cue1">Set Cue</button>
      <button id="btn-prev-cue1">Prev Cue</button>
      <button id="btn-next-cue1">Next Cue</button>
    </div>

    <!-- Playback Rate Slider for Deck 1 -->
    <div class="slider-container">
      <label for="speed-slider1" class="slider-label">Deck 1 Rate:</label>
      <input type="range" id="speed-slider1" min="0.25" max="2.0" step="0.05" value="1.0">
      <span id="speedValue1">1.00</span>x
    </div>
    
    <!-- Cue list display for Deck 1 -->
    <div id="cueList1" class="cue-list"></div>
  </div>

  <!-- Deck 2 -->
  <div class="deck-container">
    <div class="deck-title">Deck 2</div>
    
    <!-- Input & Load button -->
    <div class="video-input">
      <input type="text" id="videoLink2" placeholder="https://www.youtube.com/watch?v=VIDEO_ID" size="40">
      <button id="loadVideo2">Load Video (Deck 2)</button>
    </div>
    
    <!-- YouTube player area -->
    <div id="player2" class="player-section"></div>
    
    <!-- Mobile / Onscreen Controls for Deck 2 -->
    <div class="mobileControls" id="mobileControls2">
      <button id="btn-play2">Play/Pause</button>
      <button id="btn-set-cue2">Set Cue</button>
      <button id="btn-prev-cue2">Prev Cue</button>
      <button id="btn-next-cue2">Next Cue</button>
    </div>

    <!-- Playback Rate Slider for Deck 2 -->
    <div class="slider-container">
      <label for="speed-slider2" class="slider-label">Deck 2 Rate:</label>
      <input type="range" id="speed-slider2" min="0.25" max="2.0" step="0.05" value="1.0">
      <span id="speedValue2">1.00</span>x
    </div>
    
    <!-- Cue list display for Deck 2 -->
    <div id="cueList2" class="cue-list"></div>
  </div>

  <!-- YouTube IFrame API -->
  <script src="https://www.youtube.com/iframe_api"></script>
  <script>
    let player1, player2;
    let cuePoints1 = [];
    let cuePoints2 = [];

    // Helper: extract YouTube video ID from a URL
    function extractVideoID(url) {
      const regExp = /^.*((youtu.be\/)|(v\/)|(\/u\/\w\/)|(embed\/)|(watch\?))\??v?=?([^#&?]*).*/;
      const match = url.match(regExp);
      return (match && match[7].length === 11) ? match[7] : null;
    }

    // Called automatically by the YouTube IFrame API
    function onYouTubeIframeAPIReady() {
      // We'll create players once the user clicks "Load Video"
    }

    // Deck 1: load video or switch video
    function loadVideoDeck1(videoId) {
      if (player1) {
        player1.loadVideoById(videoId);
      } else {
        player1 = new YT.Player('player1', {
          height: '200',
          width: '320',
          videoId: videoId,
          playerVars: { autoplay: 0 },
          events: {
            'onReady': onPlayerReadyDeck1
          }
        });
      }
    }
    // Deck 2: load video or switch video
    function loadVideoDeck2(videoId) {
      if (player2) {
        player2.loadVideoById(videoId);
      } else {
        player2 = new YT.Player('player2', {
          height: '200',
          width: '320',
          videoId: videoId,
          playerVars: { autoplay: 0 },
          events: {
            'onReady': onPlayerReadyDeck2
          }
        });
      }
    }

    function onPlayerReadyDeck1() {
      console.log("Deck 1 ready.");
      // Set initial rate from slider
      const rate = parseFloat(document.getElementById('speed-slider1').value);
      player1.setPlaybackRate(rate);
    }
    function onPlayerReadyDeck2() {
      console.log("Deck 2 ready.");
      // Set initial rate from slider
      const rate = parseFloat(document.getElementById('speed-slider2').value);
      player2.setPlaybackRate(rate);
    }

    // Update deck 1 cue list
    function updateCueList1() {
      const listDiv = document.getElementById('cueList1');
      if (cuePoints1.length === 0) {
        listDiv.innerHTML = "<h4>Cue Points</h4><p>No cues yet.</p>";
      } else {
        let html = "<h4>Cue Points</h4><ul>";
        cuePoints1.forEach(time => {
          html += `<li>${time.toFixed(2)}s</li>`;
        });
        html += "</ul>";
        listDiv.innerHTML = html;
      }
    }
    // Update deck 2 cue list
    function updateCueList2() {
      const listDiv = document.getElementById('cueList2');
      if (cuePoints2.length === 0) {
        listDiv.innerHTML = "<h4>Cue Points</h4><p>No cues yet.</p>";
      } else {
        let html = "<h4>Cue Points</h4><ul>";
        cuePoints2.forEach(time => {
          html += `<li>${time.toFixed(2)}s</li>`;
        });
        html += "</ul>";
        listDiv.innerHTML = html;
      }
    }

    // ----- Deck 1 Controls -----
    function togglePlayPauseDeck1() {
      if (!player1) return;
      const state = player1.getPlayerState();
      if (state === YT.PlayerState.PLAYING) {
        player1.pauseVideo();
      } else {
        player1.playVideo();
      }
    }
    function setCueDeck1() {
      if (!player1) return;
      const t = player1.getCurrentTime();
      cuePoints1.push(t);
      cuePoints1.sort((a, b) => a - b);
      updateCueList1();
    }
    function nextCueDeck1() {
      if (!player1 || cuePoints1.length === 0) return;
      const now = player1.getCurrentTime();
      const nextCue = cuePoints1.find(time => time > now);
      if (nextCue !== undefined) {
        player1.seekTo(nextCue, true);
      }
    }
    function prevCueDeck1() {
      if (!player1 || cuePoints1.length === 0) return;
      const now = player1.getCurrentTime();
      let prevCue = null;
      for (let i = 0; i < cuePoints1.length; i++) {
        if (cuePoints1[i] < now) {
          prevCue = cuePoints1[i];
        } else {
          break;
        }
      }
      if (prevCue !== null) {
        player1.seekTo(prevCue, true);
      }
    }
    function changeRateDeck1(value) {
      if (!player1) return;
      player1.setPlaybackRate(value);
      document.getElementById('speedValue1').textContent = value.toFixed(2);
    }

    // ----- Deck 2 Controls -----
    function togglePlayPauseDeck2() {
      if (!player2) return;
      const state = player2.getPlayerState();
      if (state === YT.PlayerState.PLAYING) {
        player2.pauseVideo();
      } else {
        player2.playVideo();
      }
    }
    function setCueDeck2() {
      if (!player2) return;
      const t = player2.getCurrentTime();
      cuePoints2.push(t);
      cuePoints2.sort((a, b) => a - b);
      updateCueList2();
    }
    function nextCueDeck2() {
      if (!player2 || cuePoints2.length === 0) return;
      const now = player2.getCurrentTime();
      const nextCue = cuePoints2.find(time => time > now);
      if (nextCue !== undefined) {
        player2.seekTo(nextCue, true);
      }
    }
    function prevCueDeck2() {
      if (!player2 || cuePoints2.length === 0) return;
      const now = player2.getCurrentTime();
      let prevCue = null;
      for (let i = 0; i < cuePoints2.length; i++) {
        if (cuePoints2[i] < now) {
          prevCue = cuePoints2[i];
        } else {
          break;
        }
      }
      if (prevCue !== null) {
        player2.seekTo(prevCue, true);
      }
    }
    function changeRateDeck2(value) {
      if (!player2) return;
      player2.setPlaybackRate(value);
      document.getElementById('speedValue2').textContent = value.toFixed(2);
    }

    // ----- Event Listeners -----
    window.addEventListener('DOMContentLoaded', () => {
      // Deck 1
      document.getElementById('loadVideo1').addEventListener('click', () => {
        const url = document.getElementById('videoLink1').value;
        const videoId = extractVideoID(url);
        if (videoId) loadVideoDeck1(videoId);
        else alert("Invalid YouTube link for Deck 1");
      });
      document.getElementById('btn-play1').addEventListener('click', togglePlayPauseDeck1);
      document.getElementById('btn-set-cue1').addEventListener('click', setCueDeck1);
      document.getElementById('btn-prev-cue1').addEventListener('click', prevCueDeck1);
      document.getElementById('btn-next-cue1').addEventListener('click', nextCueDeck1);
      document.getElementById('speed-slider1').addEventListener('input', (e) => {
        const rate = parseFloat(e.target.value);
        changeRateDeck1(rate);
      });

      // Deck 2
      document.getElementById('loadVideo2').addEventListener('click', () => {
        const url = document.getElementById('videoLink2').value;
        const videoId = extractVideoID(url);
        if (videoId) loadVideoDeck2(videoId);
        else alert("Invalid YouTube link for Deck 2");
      });
      document.getElementById('btn-play2').addEventListener('click', togglePlayPauseDeck2);
      document.getElementById('btn-set-cue2').addEventListener('click', setCueDeck2);
      document.getElementById('btn-prev-cue2').addEventListener('click', prevCueDeck2);
      document.getElementById('btn-next-cue2').addEventListener('click', nextCueDeck2);
      document.getElementById('speed-slider2').addEventListener('input', (e) => {
        const rate = parseFloat(e.target.value);
        changeRateDeck2(rate);
      });
    });

    // ----- Keyboard Shortcuts -----
    document.addEventListener('keydown', (e) => {
      // If Shift is pressed => Deck 2, else Deck 1
      const isShift = e.shiftKey;

      switch(e.key) {
        case " ":
          e.preventDefault(); // prevent scrolling
          if (isShift) togglePlayPauseDeck2();
          else togglePlayPauseDeck1();
          break;
        case "c":
        case "C":
          if (isShift) setCueDeck2();
          else setCueDeck1();
          break;
        case "ArrowRight":
          if (isShift) nextCueDeck2();
          else nextCueDeck1();
          break;
        case "ArrowLeft":
          if (isShift) prevCueDeck2();
          else prevCueDeck1();
          break;
        case "ArrowUp":
          {
            // Increase speed by 0.25
            if (isShift) {
              if (player2) {
                let r = player2.getPlaybackRate();
                r = Math.min(r + 0.25, 2.0);
                changeRateDeck2(r);
                document.getElementById('speed-slider2').value = r;
              }
            } else {
              if (player1) {
                let r = player1.getPlaybackRate();
                r = Math.min(r + 0.25, 2.0);
                changeRateDeck1(r);
                document.getElementById('speed-slider1').value = r;
              }
            }
          }
          break;
        case "ArrowDown":
          {
            // Decrease speed by 0.25
            if (isShift) {
              if (player2) {
                let r = player2.getPlaybackRate();
                r = Math.max(r - 0.25, 0.25);
                changeRateDeck2(r);
                document.getElementById('speed-slider2').value = r;
              }
            } else {
              if (player1) {
                let r = player1.getPlaybackRate();
                r = Math.max(r - 0.25, 0.25);
                changeRateDeck1(r);
                document.getElementById('speed-slider1').value = r;
              }
            }
          }
          break;
      }
    });
  </script>
</body>
</html>

